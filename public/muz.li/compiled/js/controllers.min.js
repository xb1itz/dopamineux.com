/*! muzli 2017-06-01 */

angular.module("muzli").controller("indexController",["$scope","$state","$q","$rootScope","$timeout","postsService",function(a,b,c,d,e,f){var g=function(){return angular.extend(a.filter,{offset:a.page*a.pageSize,limit:a.pageSize,feed:b.params.feed})};a.initList=function(){a.isLastItemLoaded=!1,a.isListEmpty=!1,a.enableInfiniteScroll=!0,a.limit=10,a.page=0,a.posts=[],a.newPosts=[]},a.loadPosts=function(b){a.isFechingInProgress||a.isLastItemLoaded||(a.isFechingInProgress=!0,f.getPosts(b).then(function(b){var c=b.rows||b;a.count=b.count,a.posts.push.apply(a.posts,c),a.page>1&&(a.limit=a.posts.length),a.posts.length||(a.isListEmpty=!0),c&&c.length||(a.isLastItemLoaded=!0),a.isLoadingComplete=!0,a.page++,e(function(){localStorage.lastFetchTime=new Date,a.isFechingInProgress=!1,a.checkScrollPosition()})}))},a.resetList=function(){a.initList(),a.loadPosts(g())},console.log("Index controller init"),d.setPageTitle("Muzli | Demo newsfeed"),a.isFechingInProgress=!1,a.isLoadingComplete=!1,a.pageSize=10,a.newPosts=[],a.filter={order:"recent"},a.initList(),a.$on("scrollAtBottom",function(){a.enableInfiniteScroll&&a.loadPosts(g())}),a.$watch("filter.order",function(b,c){b!==c&&a.resetList()}),a.$on("newPost",function(c,d){b.params.feed&&d.data.source!==b.params.feed||a.newPosts.push(d.data)}),a.loadPosts(g()),$("html, body").animate({scrollTop:0})}]);
//# sourceMappingURL=controllers.min.js.map